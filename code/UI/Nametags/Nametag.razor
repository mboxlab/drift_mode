@using Sandbox;
@using Sandbox.UI;
@inherits PanelComponent

<root>
	@if (!Player.IsValid()) return;

	<label class="glass-panel">@PlayerName.ToUpper()</label>
</root>

@code {
	private Connection Connection => Player?.Network.OwnerConnection;
	public string PlayerName => Player?.CharacterName ?? "";

	[Property] public Car Player { get; set; }

	protected override void OnUpdate()
	{
		if (!Scene.Camera.IsValid()) return;
		Transform.Rotation = Scene.Camera.Transform.Rotation * new Angles(0, 180, 0);
		Transform.Position = GameObject.Parent.Transform.Position + Vector3.Up * 24f;
		var distance = (Scene.Camera.Transform.Position - Transform.Position).Length;
		var opacity = MathX.Clamp(1.0f - ((distance - 512f) / 1000.0f), 0.0f, 1.0f);
		Panel.Style.Opacity = opacity;
	}

	protected override int BuildHash() => System.HashCode.Combine(Player?.CharacterName);
}
